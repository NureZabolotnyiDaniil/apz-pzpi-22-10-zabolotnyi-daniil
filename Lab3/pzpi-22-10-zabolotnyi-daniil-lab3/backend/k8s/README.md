# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞: –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –±–µ–∫–µ–Ω–¥—É –≤ Kubernetes

## üéØ –ú–µ—Ç–∞ —Ä–æ–±–æ—Ç–∏
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è FastAPI –±–µ–∫–µ–Ω–¥—É –≤ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä—ñ –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –±–∞–ª–∞–Ω—Å—É–≤–∞–Ω–Ω—è–º –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª—å–Ω–∏–º —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è–º.

## üìã –ü–µ—Ä–µ–¥—É–º–æ–≤–∏

### –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–µ –ü–ó:
- ‚úÖ Minikube
- ‚úÖ kubectl
- ‚úÖ Docker Desktop
- ‚úÖ PowerShell (Windows)

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É:
- **–û–ë–û–í'–Ø–ó–ö–û–í–û**: PowerShell –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –∑–∞–ø—É—â–µ–Ω–∏–π **–≤—ñ–¥ —ñ–º–µ–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞**

## üöÄ –ö—Ä–æ–∫ 1: –î–µ–ø–ª–æ–π —Å–∏—Å—Ç–µ–º–∏

### 1.1 –ó–∞–ø—É—Å–∫ PowerShell –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```powershell
# –ü—Ä–∞–≤–∏–π –∫–ª—ñ–∫ –Ω–∞ PowerShell ‚Üí "–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞"
```

### 1.2 –ü–µ—Ä–µ—Ö—ñ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é
```powershell
cd C:\Users\danil\PycharmProjects\SmartLighting\backend\k8s
```

### 1.3 –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—é
```powershell
.\admin-deploy.ps1
```

**–©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**
- –ó–∞–ø—É—Å–∫ minikube –∑ Hyper-V –¥—Ä–∞–π–≤–µ—Ä–æ–º
- –ó–±—ñ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑—É FastAPI –¥–æ–¥–∞—Ç–∫—É
- –î–µ–ø–ª–æ–π PostgreSQL –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
- –î–µ–ø–ª–æ–π FastAPI –±–µ–∫–µ–Ω–¥—É (2 —Ä–µ–ø–ª—ñ–∫–∏)
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è HPA (Horizontal Pod Autoscaler)
- –í–∫–ª—é—á–µ–Ω–Ω—è metrics server

## üìä –ö—Ä–æ–∫ 2: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∏

### 2.1 –ó–∞–ø—É—Å–∫ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
```powershell
.\monitor.ps1
```

**–©–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è:**
- –°—Ç–∞—Ç—É—Å –ø–æ–¥—ñ–≤ (pods)
- –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—ñ–≤ (services)
- –°—Ç–∞–Ω –∞–≤—Ç–æ—Å–∫–µ–π–ª–µ—Ä–∞ (HPA)
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤ (CPU/Memory)

### 2.2 –†—É—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
```powershell
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ–¥—ñ–≤
kubectl get pods

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Ä–≤—ñ—Å—ñ–≤
kubectl get services

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ HPA
kubectl get hpa

# –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ HPA
kubectl describe hpa smartlighting-backend-hpa
```

## üî• –ö—Ä–æ–∫ 3: –ù–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª—å–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 3.1 –û—Ç—Ä–∏–º–∞–Ω–Ω—è URL —Å–µ—Ä–≤—ñ—Å—É
```powershell
minikube service smartlighting-backend-service --url
```

### 3.2 –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
```powershell
# –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –¥–æ 5 —Ä–µ–ø–ª—ñ–∫ + –Ω–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª—å–Ω–∏–π —Ç–µ—Å—Ç
.\scale-test.ps1 -Replicas 5

# –ê–±–æ –∑ –≤–∫–∞–∑–∞–Ω–Ω—è–º URL
.\scale-test.ps1 -Replicas 3 -ServiceUrl "http://192.168.1.100:31216"
```

### 3.3 –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π Python —Ç–µ—Å—Ç
```powershell
# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
pip install aiohttp

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—É
python load_test.py --url http://192.168.1.100:31216 --duration 120 --rps 20
```

## üìà –ö—Ä–æ–∫ 4: –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è

### 4.1 –†—É—á–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
```powershell
# –ó–±—ñ–ª—å—à–µ–Ω–Ω—è –¥–æ 6 —Ä–µ–ø–ª—ñ–∫
kubectl scale deployment smartlighting-backend --replicas=6

# –ó–º–µ–Ω—à–µ–Ω–Ω—è –¥–æ 2 —Ä–µ–ø–ª—ñ–∫
kubectl scale deployment smartlighting-backend --replicas=2

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É
kubectl get pods -l app=smartlighting-backend
```

### 4.2 –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è (HPA)
```powershell
# –°–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–∞ –∞–≤—Ç–æ—Å–∫–µ–π–ª–µ—Ä–æ–º
kubectl get hpa -w

# –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
kubectl describe hpa smartlighting-backend-hpa
```

## üîß –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:
1. **PostgreSQL** - –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö (1 —Ä–µ–ø–ª—ñ–∫–∞)
2. **FastAPI Backend** - –í–µ–±-–¥–æ–¥–∞—Ç–æ–∫ (2-10 —Ä–µ–ø–ª—ñ–∫)
3. **LoadBalancer** - –†–æ–∑–ø–æ–¥—ñ–ª –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
4. **HPA** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
5. **Metrics Server** - –ó–±—ñ—Ä –º–µ—Ç—Ä–∏–∫

### –ú–µ—Ä–µ–∂–∞:
```
Internet ‚Üí LoadBalancer ‚Üí Backend Pods ‚Üí PostgreSQL
```

## üìä –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è HPA

### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –∞–≤—Ç–æ—Å–∫–µ–π–ª–µ—Ä–∞:
- **–ú—ñ–Ω—ñ–º—É–º —Ä–µ–ø–ª—ñ–∫**: 2
- **–ú–∞–∫—Å–∏–º—É–º —Ä–µ–ø–ª—ñ–∫**: 10
- **CPU threshold**: 70%
- **Memory threshold**: 80%
- **Scale Up**: max 100% –∑–∞ 15 —Å–µ–∫—É–Ω–¥
- **Scale Down**: max 50% –∑–∞ 60 —Å–µ–∫—É–Ω–¥

### –†–µ—Å—É—Ä—Å–∏ –ø–æ–¥—ñ–≤:
- **CPU Request**: 100m
- **CPU Limit**: 200m
- **Memory Request**: 128Mi
- **Memory Limit**: 256Mi

## üß™ –°—Ü–µ–Ω–∞—Ä—ñ—ó —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
```powershell
.\scale-test.ps1 -Replicas 2
```
**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: 2 —Ä–µ–ø–ª—ñ–∫–∏ —Å–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è –∑ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º

### –¢–µ—Å—Ç 2: –í–∏—Å–æ–∫–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
```powershell
.\scale-test.ps1 -Replicas 5
```
**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: HPA –∑–±—ñ–ª—å—à—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä–µ–ø–ª—ñ–∫

### –¢–µ—Å—Ç 3: –ü—ñ–∫–æ–≤–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
```powershell
python load_test.py --url $URL --duration 300 --rps 50
```
**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –¥–æ –º–∞–∫—Å–∏–º—É–º—É (10 —Ä–µ–ø–ª—ñ–∫)

## üìù –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –ë–µ–∑ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è:
- 2 —Ä–µ–ø–ª—ñ–∫–∏ backend pod—ñ–≤
- CPU utilization: <10%
- Memory utilization: <20%

### –ü—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º:
- 3-10 —Ä–µ–ø–ª—ñ–∫ (–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è)
- CPU utilization: 60-80%
- Memory utilization: 40-70%
- RPS: 50-200 requests/second

## üõ†Ô∏è –£—Å—É–Ω–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É
```powershell
# –ó–∞–ø—É—Å–∫–∞–π PowerShell –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞!
```

### –ü—Ä–æ–±–ª–µ–º–∞: Docker –Ω–µ –ø—Ä–∞—Ü—é—î
```powershell
# –ó–∞–ø—É—Å—Ç–∏ Docker Desktop –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–¥–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—å—Å—è
```powershell
# –ü–µ—Ä–µ–≤—ñ—Ä –ª–æ–≥–∏
kubectl logs -l app=smartlighting-backend

# –ü–µ—Ä–µ–≤—ñ—Ä –æ–±—Ä–∞–∑
kubectl describe pod <pod-name>
```

### –ü—Ä–æ–±–ª–µ–º–∞: HPA –Ω–µ –ø—Ä–∞—Ü—é—î
```powershell
# –ü–µ—Ä–µ–≤—ñ—Ä metrics server
kubectl get apiservice v1beta1.metrics.k8s.io -o yaml

# –ü–µ—Ä–µ–≤—ñ—Ä —Ä–µ—Å—É—Ä—Å–∏
kubectl top pods
```

## üìö –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

### –î–µ–ø–ª–æ–π —Ç–∞ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è:
```powershell
# –ü–æ–≤–Ω–∏–π –¥–µ–ø–ª–æ–π
.\admin-deploy.ps1

# –í–∏–¥–∞–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö —Ä–µ—Å—É—Ä—Å—ñ–≤
kubectl delete -f .

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—é
kubectl rollout restart deployment/smartlighting-backend
```

### –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥:
```powershell
# –†–µ–∞–ª-—Ç–∞–π–º –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
.\monitor.ps1

# –õ–æ–≥–∏
kubectl logs -f deployment/smartlighting-backend

# Metrics
kubectl top nodes
kubectl top pods
```

### –ù–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è:
```powershell
# –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ø–æ–¥–∞
kubectl exec -it <pod-name> -- bash

# –ü–æ—Ä—Ç-—Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥
kubectl port-forward service/smartlighting-backend-service 8080:80
```

## üéØ –ö—Ä–∏—Ç–µ—Ä—ñ—ó —É—Å–ø—ñ—Ö—É

‚úÖ **–î–µ–ø–ª–æ–π**: –í—Å—ñ –ø–æ–¥–∏ –∑–∞–ø—É—â–µ–Ω—ñ —Ç–∞ –≥–æ—Ç–æ–≤—ñ
‚úÖ **–î–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å**: API –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ /health
‚úÖ **–ú–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è**: HPA –ø—Ä–∞—Ü—é—î –ø—Ä–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
‚úÖ **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**: RPS –∑—Ä–æ—Å—Ç–∞—î –∑ –∫—ñ–ª—å–∫—ñ—Å—Ç—é —Ä–µ–ø–ª—ñ–∫
‚úÖ **–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞—Ü—é—î –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º

## üìã –î–ª—è –∑–≤—ñ—Ç—É

### –û–±–æ–≤'—è–∑–∫–æ–≤—ñ —Å–∫—Ä—ñ–Ω—à–æ—Ç–∏:
1. `kubectl get pods` - —Å—Ç–∞—Ç—É—Å –ø–æ–¥—ñ–≤
2. `kubectl get hpa` - —Å—Ç–∞–Ω –∞–≤—Ç–æ—Å–∫–µ–π–ª–µ—Ä–∞
3. –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É
4. –ì—Ä–∞—Ñ—ñ–∫–∏ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è (–∑ monitor.ps1)

### –ê–Ω–∞–ª—ñ–∑:
- RPS –¥–æ/–ø—ñ—Å–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
- –ß–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –¥–æ/–ø—ñ—Å–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ—Å—É—Ä—Å—ñ–≤
- –®–≤–∏–¥–∫—ñ—Å—Ç—å –∞–≤—Ç–æ—Å–∫–µ–π–ª–µ—Ä–∞ 